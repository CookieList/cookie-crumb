function detectSwipeDircetion(t,e){var a,i,s,r,n,d,o=e||function(t){};t.addEventListener("touchstart",function(t){t=t.changedTouches[0];a="none",dist=0,i=t.pageX,s=t.pageY,d=(new Date).getTime()},!1),t.addEventListener("touchend",function(t){t=t.changedTouches[0];r=t.pageX-i,n=t.pageY-s,(new Date).getTime()-d<=300&&(130<=Math.abs(r)&&Math.abs(n)<=100?a=r<0?"left":"right":130<=Math.abs(n)&&Math.abs(r)<=100&&(a=n<0?"up":"down")),o(a)},!1)}jQuery.state={},(e=>{e.id=function(t){return e("#"+e.escapeSelector(t))}})(jQuery),(a=>{a.attribute=function(t,e){return a(e?"["+t+"='"+e+"']":"["+t+"]")}})(jQuery),(a=>{a.fn.textWidth=function(t,e){return a.fn.textWidth.fakeEl||(a.fn.textWidth.fakeEl=a('<span class="z-[1]">').hide().appendTo(document.body)),a.fn.textWidth.fakeEl.text(t||this.val()||this.text()).css("font",e||this.css("font")),a.fn.textWidth.fakeEl.width()}})(jQuery),$.state.months_name={0:"Jan",1:"Feb",2:"Mar",3:"Apr",4:"May",5:"Jun",6:"Jul",7:"Aug",8:"Sep",9:"Oct",10:"Nov",11:"Dec"},$.state.graphql=`
query ($username: String, $userid: Int) {
    ANIME: MediaListCollection(userId: $userid, userName: $username, type: ANIME, status_in: [CURRENT, REPEATING], forceSingleCompletedList: true) {
        ...media
    }
    MANGA: MediaListCollection(userId: $userid, userName: $username, type: MANGA, status_in: [CURRENT, REPEATING], forceSingleCompletedList: true) {
        ...media
    }
    USER: User(id: $userid, name: $username) {
        id
        name
        avatar {
            large
        }
        siteUrl
    }
}

fragment media on MediaListCollection {
    lists {
        isCustomList
        entries {
            media {
                id
                title {
                    english
                    native
                    romaji
                }
                status(version: 2)
                type
                format
                episodes
                duration
                isFavourite
                chapters
                episodes
                coverImage {
                    large
                }
                nextAiringEpisode {
                    airingAt
                    episode
                }
                mediaListEntry {
                    progress
                    progressVolumes
                    status
                    repeat
                    score(format: POINT_100)
                }
                siteUrl
            }
        }
    }
}

`,$.state.status_window_graphql=`
mutation ($mediaid: Int, $status: MediaListStatus, $score: Int, $repeat: Int, $progress: Int, $volumes: Int) {
    SaveMediaListEntry(mediaId: $mediaid, status: $status, scoreRaw: $score, repeat: $repeat, progress: $progress, progressVolumes: $volumes) {
        mediaId
        status
        progress
        repeat
        score(format: POINT_100)
        progressVolumes
        media {
            duration
        }
    }
}

`,$.state.status_window_graphql_with_like_toggle=`
mutation ($mediaid_anime: Int, $mediaid_manga: Int, $mediaid: Int, $status: MediaListStatus, $score: Int, $repeat: Int, $progress: Int, $volumes: Int) {
    SaveMediaListEntry(mediaId: $mediaid, status: $status, scoreRaw: $score, repeat: $repeat, progress: $progress, progressVolumes: $volumes) {
        mediaId
        status
        progress
        repeat
        score(format: POINT_100)
        progressVolumes
        media {
            duration
        }
    }
    ToggleFavourite(animeId: $mediaid_anime, mangaId: $mediaid_manga) {
        anime {
            pageInfo {
                currentPage
            }
        }
        manga {
            pageInfo {
                currentPage
            }
        }
    }
}

`,$.state.increment_graphql=`
mutation ($mediaid: Int, $progress: Int) {
    SaveMediaListEntry(mediaId: $mediaid, progress: $progress) {
        progress
        media {
            duration
        }
    }
}

`,$.state.query_user_graphql=`
{
    Viewer {
        id
        name
        avatar {
            medium
        }
        siteUrl
    }
}

`,$.state.media_lists_graphql=`
query ($userid: Int, $mediatype: MediaType) {
    chunk_1: MediaListCollection(userId: $userid, type: $mediatype, forceSingleCompletedList: true, perChunk: 500, chunk: 1) {
        ...collection
    }
    chunk_2: MediaListCollection(userId: $userid, type: $mediatype, forceSingleCompletedList: true, perChunk: 500, chunk: 2) {
        ...collection
    }
    chunk_3: MediaListCollection(userId: $userid, type: $mediatype, forceSingleCompletedList: true, perChunk: 500, chunk: 3) {
        ...collection
    }
    chunk_4: MediaListCollection(userId: $userid, type: $mediatype, forceSingleCompletedList: true, perChunk: 500, chunk: 4) {
        ...collection
    }
    chunk_5: MediaListCollection(userId: $userid, type: $mediatype, forceSingleCompletedList: true, perChunk: 500, chunk: 5) {
        ...collection
    }
    chunk_6: MediaListCollection(userId: $userid, type: $mediatype, forceSingleCompletedList: true, perChunk: 500, chunk: 6) {
        ...collection
    }
}

fragment collection on MediaListCollection {
    lists {
        isCustomList
        status
        entries {
            media {
                id
                title {
                    userPreferred
                }
                type
                format
                coverImage {
                    medium
                    large
                }
                siteUrl
            }
        }
    }
}

`,$.state.current_main_content="watchlist",$.state.current_schedule_day_active=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"][(new Date).getDay()],$.state.current_main_content_type="anime",$.state.session_cache_id="ANILIST_RESPONSE",$.state.session_anime_list_cache_id="ANILIST_RESPONSE_ANIME";var USE_CACHE=!($.state.session_manga_list_cache_id="ANILIST_RESPONSE_MANGA");function initializeCookieCrumb(){var t,e=localStorage.getItem("ANILIST_USER");e?(e=JSON.parse(e),$.state.session_token=e.token,$.state.session_id=e.id,$.state.session_name=e.name,$.state.session_avatar=e.avatar,$.state.session_site_url=e.site,$.id("[F].avatar").attr("src",$.state.session_avatar),$.id("[F]-confirm_logout.image").attr("src",$.state.session_avatar),$.id("[F]-confirm_logout.name").html($.state.session_name),$.id("[F]-logout_confirm.link").html($.state.session_name),$.id("[F]-logout_confirm.link").attr("href",$.state.session_site_url),queryAniList()):""===(t=window.location.hash?(t=(t=(t=(t=window.location.hash.substring(1)).split("access_token=")[1]).split("&token_type")[0]).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/>/g,"&gt;")).trim():t)||null==t?setTimeout(()=>{$.id("[L]-start_up_window").attr("data-require-login","true")},300):($.id("[L]-login-menu-options-confirm").addClass("!duration-[0ms]"),$.id("[L]-login-menu-options-inputs").addClass("!duration-[0ms]"),$.id("[L]-login-menu").attr("data-confirm-continue","true"),setTimeout(()=>{$.id("[L]-login-menu").attr("data-confirm-continue","true"),apiKeyLogin(t)},100))}function viewFotterSchedule(){$.id("[F]").attr("data-show-schedule","true")}function hideFooterSchedule(){$.id("[F]").attr("data-show-schedule","false"),$.id("[F].fotter_schedule")[0].scrollTo({top:0,behavior:"instant"})}function logoutUser(){$.each(["ANILIST_USER","WATCHLIST_FORMAT","ANILIST_RESPONSE_MANGA","ANILIST_RESPONSE_ANIME","SCHEDULE_FORMAT","WATCHLIST_TYPE","LISTS_FORMAT","ANILIST_RESPONSE","LAST_MAIN_CONTENT"],(t,e)=>{localStorage.getItem(e)&&localStorage.removeItem(e)}),setTimeout(()=>{window.location.reload()},200)}function hideLogOutWindow(){$.id("[F]-logout_confirm").attr("data-is-active","false"),$.id("[F]-screen").fadeOut()}function showLogOutWindow(){$.id("[F]-logout_confirm").attr("data-is-active","true"),$.id("[F]-screen").fadeIn()}function reFreshCookieCrumb(){USE_CACHE&&(localStorage.removeItem($.state.session_cache_id),localStorage.removeItem($.state.session_anime_list_cache_id),localStorage.removeItem($.state.session_manga_list_cache_id)),$.id("[L]").attr("data-hide-window","false"),resetListsView(),initializeCookieCrumb()}function apiKeyLogin(a=null){var i=!0,s=(null===a&&(a=$.id("[L]-api_key_login_input").val().trim(),i=!1),$.id("[L]-api_key_login_button"));""!==a||i?(i||s.attr("data-is-logging-in","true"),$.ajax({url:"https://graphql.anilist.co",method:"POST",timeout:4e4,headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:"Bearer "+a},data:JSON.stringify({query:$.state.query_user_graphql}),error:()=>{$.id("[L]-api_key_login_error").html("Wrong API Key."),i||s.attr("data-is-logging-in","false")},success:t=>{$.id("[L]-confirm.image").attr("src",t.data.Viewer.avatar.medium),$.id("[L]-confirm.name").html(t.data.Viewer.name),$.id("[L]-confirm.continue_text").html(t.data.Viewer.name),$.id("[L]-confirm.continue_link").attr("href",t.data.Viewer.siteUrl);var e=$.id("[L]-confirm.continue_button");e.attr("data-token",a),e.attr("data-id",t.data.Viewer.id),e.attr("data-name",t.data.Viewer.name),e.attr("data-avatar",t.data.Viewer.avatar.medium),e.attr("data-site",t.data.Viewer.siteUrl),i?$.id("[L]-start_up_window").attr("data-require-login","true"):(s.attr("data-is-logging-in","false"),setTimeout(()=>{$.id("[L]-login-menu").attr("data-confirm-continue","true")},200))}})):$.id("[L]-api_key_login_error").html("API key cant be empty.")}function confirmLogin(){var t=$.id("[L]-confirm.continue_button");$.state.session_token=t.attr("data-token"),$.state.session_id=t.attr("data-id"),$.state.session_name=t.attr("data-name"),$.state.session_avatar=t.attr("data-avatar"),$.state.session_site_url=t.attr("data-site"),localStorage.setItem("ANILIST_USER",JSON.stringify({token:$.state.session_token,id:$.state.session_id,name:$.state.session_name,avatar:$.state.session_avatar,site:$.state.session_site_url})),$.id("[L]-start_up_window").attr("data-require-login","false"),setTimeout(()=>{initializeCookieCrumb()},100)}function removeWaitingPage(){$.id("[L]").attr("data-hide-window","true")}function changeMainContent(t){var e=t,t="watchlist"===t?["schedule","lists"]:"schedule"===t?["watchlist","lists"]:["schedule","watchlist"];$.state.current_main_content!==e&&($.state.current_main_content=e,localStorage.setItem("MAIN_CONTENT",e),$.each(t,(t,e)=>{$.id("[H]-"+e).removeClass("text-crumb-bright/90").addClass("text-crumb-bright/30"),$.id("[H]-"+e+".text").addClass("hidden")}),$.id("[H]-"+e).removeClass("text-crumb-bright/30").addClass("text-crumb-bright/90"),$.id("[H]-"+e+".text").removeClass("hidden"),$.id("[M]").attr("data-current-main-content",e),"watchlist"===e?$.id("[H]-format_toggle").attr("data-active-format",$.id("[M]-watchlist").attr("data-current-watchlist-format")):"schedule"===e?$.id("[H]-format_toggle").attr("data-active-format",$.id("[M]-schedule").attr("data-current-schedule-format")):$.id("[H]-format_toggle").attr("data-active-format",$.id("[M]-lists").attr("data-current-lists-format")))}function queryAniList(){var t=localStorage.getItem($.state.session_cache_id);t&&USE_CACHE?($.state.sessionWatchList=JSON.parse(t),generateAndDisplayContent($.state.sessionWatchList)):$.ajax({url:"https://graphql.anilist.co",method:"POST",timeout:1e4,headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:"Bearer "+$.state.session_token},data:JSON.stringify({query:$.state.graphql,variables:{userid:$.state.session_id,username:$.state.session_name}}),error:()=>{makeNotification("Retrying !"),console.log("retying"),setTimeout(()=>{reFreshCookieCrumb()},5e3)},success:t=>{var t=processResponse(t),a={};$.each(t,(t,e)=>{a[String(e.id)]=e}),USE_CACHE&&localStorage.setItem($.state.session_cache_id,JSON.stringify(a)),generateAndDisplayContent($.state.sessionWatchList=a)}})}function processResponse(t){var a=[],i=[],t=(t=t.data.ANIME.lists.concat(t.data.MANGA.lists)).filter(t=>!t.isCustomList);return $.each(t,(t,e)=>{a=a.concat(e.entries)}),$.each(a,(t,e)=>{e=e.media;i.push({id:e.id,title:e.title.english||e.title.romaji||e.title.native,english:e.title.english,romaji:e.title.romaji,native:e.title.native,type:e.type,status:e.status,format:e.format,episodes:e.episodes||e.chapters,duration:e.duration||0,cover:e.coverImage.large,url:e.siteUrl,list:e.mediaListEntry.status,progress:e.mediaListEntry.progress,next:null===e.nextAiringEpisode?null:e.nextAiringEpisode.episode,airing:null===e.nextAiringEpisode?null:e.nextAiringEpisode.airingAt,repeat:e.mediaListEntry.repeat,score:e.mediaListEntry.score,favourite:e.isFavourite,volumes:e.mediaListEntry.progressVolumes})}),i}function toggleMainContentFormat(t=null){("watchlist"===$.state.current_main_content?toggleWatchListFormat:"schedule"===$.state.current_main_content?toggleScheduleFormat:toggleListsFormat)(t)}function toggleListsFormat(t=null){t=null===t?"grids"===$.id("[H]-format_toggle").attr("data-active-format")?"stacked":"grids":t,localStorage.setItem("LISTS_FORMAT",t),$.id("[H]-format_toggle").attr("data-active-format",t),$.id("[M]-lists").attr("data-current-lists-format",t)}function toggleScheduleFormat(t=null){t=null===t?"grids"===$.id("[H]-format_toggle").attr("data-active-format")?"stacked":"grids":t,$.id("[H]-format_toggle").attr("data-active-format",t),$.id("[M]-schedule").attr("data-current-schedule-format",t),$.state.current_schedule_format=t,localStorage.setItem("SCHEDULE_FORMAT",t)}function toggleWatchListFormat(t=null){t=null===t?"grids"===$.id("[H]-format_toggle").attr("data-active-format")?"stacked":"grids":t,localStorage.setItem("WATCHLIST_FORMAT",t),$.id("[H]-format_toggle").attr("data-active-format",t),$.id("[M]-watchlist").attr("data-current-watchlist-format",t)}function getTodaysDate(){return["sunday","monday","tuesday","wednesday","thursday","friday","saturday"][(new Date).getDay()]}function humantimeFormat(t,e=!0){var a;return null===t||"null"===t?"":(e=e?Math.round(new Date(1e3*t).getTime()/1e3)-Math.round((new Date).getTime()/1e3):t,t=Math.floor(e/86400),a=Math.floor(e/3600%24),e=Math.floor(e%3600/60),(0<t?t+`<span>d</span> ${a+(30<e?1:0)}<span>h</span>`:0<a?a+`<span>h</span> ${e}<span>m</span>`:e+"<span>m</span>").replace(/0/g,"O"))}function updateScheduleTime(t,e){var a=new Date,e="stacked"===e?t=>t.replace(/0/g,"O"):t=>t.replace(/Aired at /g,"").replace(/></g,">:<").replace(/0/g,"O"),i=new Date(1e3*$.state.sessionWatchList[t].airing),s=Math.round(i.getTime()/1e3)-Math.round(a.getTime()/1e3);if(i.getDay()===a.getDay()){var r=i.getHours(),n=i.getMinutes();if(60*r*60+60*n+i.getSeconds()<60*a.getHours()*60+60*a.getMinutes()+a.getSeconds())return $.attribute("updating-airing-time-widget-id",t).attr("data-has-media-aired","true"),i="AM",12<r&&(r-=12,i="PM"),{aired:!0,html:e(`Aired at ${r=r<10?"0"+String(r):r}:${n=n<10?"0"+String(n):n} `+i)}}return{aired:!1,html:e(`<i day>${Math.floor(s/86400)}</i><i hour>${Math.floor(s/3600%24)}</i><i minute>${Math.floor(s%3600/60)}</i><i second>${Math.floor(s%60)}</i>`)}}function displayFooterInfo(t){t=t.filter(t=>t.airing),$.id("[F].fotter_schedule").html(nunjucks.renderString($.id("[F]-schedule@template").html(),{collection:t})),$.state.footer_update_interval&&clearInterval($.state.footer_update_interval);t=()=>{var t=$("[data-footer-airing-schedule]");t.each((t,e)=>{var a,i,e=$(e),s=new Date,r=e.attr("data-footer-airing-schedule"),n=new Date(1e3*$.state.sessionWatchList[Number(r)].airing),n=Math.round(n.getTime()/1e3)-Math.round(s.getTime()/1e3);0<n?(s=Math.floor(n/86400),a=Math.floor(n/3600%24),i=Math.floor(n%3600/60),n=Math.floor(n%60),e.html(`${s<10?0:""}${s}:${a<10?0:""}${a}:${i<10?0:""}${i}:`+(n<10?0:"")+n)):($.attribute("footer-schedule-id",r).remove(),$.attribute("footer-schedule-division-id",r).remove())}),t.length<=0&&($.id("[F].fotter_schedule").html('<span class="mx-3 text-center flex items-center justify-center leading-tight text-[0.6rem] text-crumb-bright/30 h-full" onclick="event.stopPropagation();reFreshCookieCrumb()">Click to Refresh.</span>'),clearInterval($.state.footer_update_interval))};t(),$.state.footer_update_interval=setInterval(t,900)}function generateAndDisplayContent(t){var a=[],t=($.each(t,(t,e)=>{a.push(e)}),a.sort((t,e)=>t.airing-e.airing),displayFooterInfo(a),generateWatchListContent(a)),e=generateScheduleContent(a),i=(displayWatchListContentStacked(t),displayWatchListContentGrids(t),{}),s=($.each(t,(t,a)=>{$.each(a.content,(t,e)=>{i[String(e.id)]=a.category})}),displayScheduleStacked(e,i),displayScheduleGrids(e,i),$.state.schedule_update_interval&&clearInterval($.state.schedule_update_interval),$.state.schedule_update_interval=setInterval(()=>{"schedule"===$.state.current_main_content&&("stacked"===$.state.current_schedule_format?$("[updating-airing-time]",$.attribute("schedule-of-day",$.state.current_schedule_day_active)):$("[updating-airing-time]",$.id("[M]-schedule.grids.content"))).each((t,e)=>{var e=$(e),a=String(e.attr("updating-airing-time"));e.html(updateScheduleTime(a,$.state.current_schedule_format).html)})},900),localStorage.getItem("MAIN_CONTENT")||"watchlist"),t=localStorage.getItem("SCHEDULE_FORMAT")||"grids",e=localStorage.getItem("WATCHLIST_FORMAT")||"grids",r=localStorage.getItem("LISTS_FORMAT")||"grids",n=localStorage.getItem("WATCHLIST_TYPE")||"anime";toggleListsFormat(r),toggleScheduleFormat(t),toggleWatchListFormat(e),toggleWatchListType(n),setTimeout(()=>{scrollGridScheduleIntoView(getTodaysDate(),"instant")},100),setTimeout(()=>{changeScheduleDay(getTodaysDate(),"instant")},100),setTimeout(()=>{changeMainContent(s)},50),$("img[lazyload]").lazyload(),setTimeout(()=>{removeWaitingPage()},200),setTimeout(()=>{fetchAndDisplayListsContent("ANIME")},500)}function scrollGridScheduleIntoView(t,e="smooth"){$.attribute("data-grid-schedule-category",t)[0].scrollIntoView({behavior:e,block:"start"})}function getElementVisibilityPercentage(t){var t=t.getBoundingClientRect(),e=window.innerHeight||document.documentElement.clientHeight;return t.bottom<0||t.top>=e?0:(e=Math.min(t.bottom,e)-Math.max(t.top,0),t=t.height,Math.max(0,e)/t)}function toggleMoreInfoScheduleGrid(t){var e=$.attribute("schedule-grid-block-id",t),a="true"===e.attr("data-show-more-info")?"false":"true";e.attr("data-show-more-info",a),"true"==a&&($.state.last_active_more_info_schedule_grid&&$.state.last_active_more_info_schedule_grid!==t&&$.attribute("schedule-grid-block-id",$.state.last_active_more_info_schedule_grid).attr("data-show-more-info","false"),$.state.last_active_more_info_schedule_grid=t)}function generateScheduleContent(t){var e=[],t=t.filter(t=>null!==t.airing),a=t.filter(t=>1===new Date(1e3*t.airing).getDay()),i=t.filter(t=>2===new Date(1e3*t.airing).getDay()),s=t.filter(t=>3===new Date(1e3*t.airing).getDay()),r=t.filter(t=>4===new Date(1e3*t.airing).getDay()),n=t.filter(t=>5===new Date(1e3*t.airing).getDay()),d=t.filter(t=>6===new Date(1e3*t.airing).getDay()),t=t.filter(t=>0===new Date(1e3*t.airing).getDay());return e.push({category:"monday",content:a,name:"Monday"}),e.push({category:"tuesday",content:i,name:"Tuesday"}),e.push({category:"wednesday",content:s,name:"Wednesday"}),e.push({category:"thursday",content:r,name:"Thursday"}),e.push({category:"friday",content:n,name:"Friday"}),e.push({category:"saturday",content:d,name:"Saturday"}),e.push({category:"sunday",content:t,name:"Sunday"}),e}function changeScheduleDay(t,e="smooth"){$("[data-active-day]").attr("data-active-day",t),$.id("[M]-schedule.stacked.section@"+t)[0].scrollIntoView({behavior:e,block:"nearest"}),$.state.current_schedule_day_active=t}function displayScheduleStacked(t,e){$.id("[M]-schedule.stacked.content").html(nunjucks.renderString($.id("[M]-schedule.stacked@template").html(),{collection:t,humanTime:humantimeFormat,daysOfWeek:{monday:"Monday",tuesday:"Tuesday",wednesday:"Wednesday",thursday:"Thursday",friday:"Friday",saturday:"Saturday",sunday:"Sunday"},relations:e,scheduleTimePlaceHolder:updateScheduleTime,getTodaysDate:getTodaysDate}))}function displayScheduleGrids(t,e){$.id("[M]-schedule.grids.content").html(nunjucks.renderString($.id("[M]-schedule.grids@template").html(),{collection:t,humanTime:humantimeFormat,relations:e,scheduleTimePlaceHolder:updateScheduleTime,getTodaysDate:getTodaysDate}))}function gridMoreInfoDisplayToggle(t){$.state.more_info_grid_id!==t&&$("[data-is-clicked]",$("[data-grid-id="+$.state.more_info_grid_id+"]")).attr("data-is-clicked","false");t=$("[data-is-clicked]",$("[data-grid-id="+($.state.more_info_grid_id=t)+"]"));t.attr("data-is-clicked","true"==t.attr("data-is-clicked")?"false":"true")}function displayWatchListContentGrids(t){$.id("[M]-watchlist.grids.content").html(nunjucks.renderString($.id("[M]-watchlist.grids@template").html(),{categories:t,humanTime:humantimeFormat,getIcon:getWatchListIcon}))}function displayWatchListContentStacked(t){$.id("[M]-watchlist.stacked.content").html(nunjucks.renderString($.id("[M]-watchlist.stacked@template").html(),{categories:t,humanTime:humantimeFormat,getIcon:getWatchListIcon}))}function showMediaEditWindow(t,e){var t=$.state.sessionWatchList[String(t)],a=$.id("[P].media_title");a.text(t.title),a.textWidth()>a.parent().width()&&a.wrap('<marquee id="[P]@__remove_marquee"></marquee>'),$.id("[P].current_status").attr("data-current-status-id",t.list),$.id("[P].current_status").attr("data-current-status-window-media-type",t.type),$.id("[P].status_and_volume_container").attr("data-current-status-window-media-type",t.type),$.id("[P].repeats").val(t.repeat),$.id("[P].repeats").attr("data-last-valid-value",t.repeat),$.id("[P].volumes").val(t.volumes),$.id("[P].volumes").attr("data-last-valid-value",t.volumes),$.id("[P].progress").val(t.progress),$.id("[P].progress").attr("data-last-valid-value",t.progress),a=t.next?t.next-1:t.episodes||"infinite",$.id("[P].progress").attr("data-max-episodes",a),$.id("[S].status_sellection.current").attr("data-current-status-window-media-type",t.type),$.id("[S].status_sellection.planning").attr("data-current-status-window-media-type",t.type),$.id("[P].media_liked").attr("data-is-media-liked",t.favourite),$.id("[P].score_input").val(t.score),$.id("[P].score_input").attr("data-last-valid-value",t.score),$.id("[P].score_slider").val(t.score),$.id("[P].save").attr("data-current-status-window-id",t.id),$.id("[P].save").attr("data-current-status-window-media-type",t.type),$.id("[P].save").attr("data-current-status-window-category",e),$.id("[P].site_link").attr("href",t.url),$.id("[P].media_name_en").attr("data-clipboard-text",t.english),$.id("[P].media_name_ro").attr("data-clipboard-text",t.romaji),$.id("[P].media_name_jp").attr("data-clipboard-text",t.native),$.id("[P]").attr("data-is-active","true"),$.id("[P]-screen").fadeIn()}function addMediaToFavourite(){var t=$.id("[P].media_liked"),e="true"===t.attr("data-is-media-liked")?"false":"true";t.attr("data-is-media-liked",e)}function toggleWatchListType(t){var e=$.id("[M]-watchlist.type");$.state.current_main_content_type!==t&&($.state.current_main_content_type=t,localStorage.setItem("WATCHLIST_TYPE",t),$.id("[M]-watchlist.stacked.content").attr("data-display-media-type",t),$.id("[M]-watchlist.grids.content").attr("data-display-media-type",t),e.attr("data-watchlist-type",t))}function saveCurrentMediaStatusWindow(){var u=Number($.id("[P].save").attr("data-current-status-window-id")),t={mediaid:u,status:String($.id("[P].current_status").attr("data-current-status-id")).toUpperCase(),score:Number($.id("[P].score_input").val()),repeat:Number($.id("[P].repeats").val()),progress:Number($.id("[P].progress").val())},m=("ANIME"===$.id("[P].save").attr("data-current-status-window-media-type")?t.mediaid_anime=u:(t.mediaid_manga=u,t.volumes=Number($.id("[P].volumes").val())),!1),g=("true"===$.id("[P].media_liked").attr("data-is-media-liked")!==$.state.sessionWatchList[u].favourite&&(m=!0),$.attribute("data-stacked-id",String(u))),p=$.attribute("data-grid-id",String(u));$("[data-is-updating]",g).attr("data-is-updating","true"),$("[data-is-updating]",p).attr("data-is-updating","true"),$.id("[P].save").attr("data-is-saving","true"),$.ajax({url:"https://graphql.anilist.co",method:"POST",timeout:4e4,headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:"Bearer "+$.state.session_token},data:JSON.stringify({query:m?$.state.status_window_graphql_with_like_toggle:$.state.status_window_graphql,variables:t}),error:()=>{makeNotification("Failed to Update !"),$.id("[P].save").attr("data-is-saving","false"),$("[data-is-updating]",g).attr("data-is-updating","false"),$("[data-is-updating]",p).attr("data-is-updating","false")},success:t=>{var e,a=$.state.sessionWatchList[u],i=a.progress,s=(a.list=t.data.SaveMediaListEntry.status,a.progress=t.data.SaveMediaListEntry.progress,a.repeat=t.data.SaveMediaListEntry.repeat,a.score=t.data.SaveMediaListEntry.score,a.volumes=t.data.SaveMediaListEntry.progressVolumes,m&&(a.favourite=!a.favourite),$.id("[P].current_status").attr("data-current-status-id",a.list),$.id("[P].repeats").val(a.repeat),$.id("[P].repeats").attr("data-last-valid-value",a.repeat),$.id("[P].volumes").val(a.volumes),$.id("[P].volumes").attr("data-last-valid-value",a.volumes),$.id("[P].progress").val(a.progress),$.id("[P].progress").attr("data-last-valid-value",a.progress),$.id("[P].media_liked").attr("data-is-media-liked",a.favourite),$.id("[P].score_input").val(a.score),$.id("[P].score_input").attr("data-last-valid-value",a.score),$.id("[P].score_slider").val(a.score),e=a.next?a.next-1:a.episodes||1/0,$.id("[P].save").attr("data-current-status-window-category")),r=$.attribute("data-category-left-episode",s),n=$.attribute("data-category-left-duration",s),d=Number(r.attr("data-left-episode")),o=Number(n.attr("data-left-duration")),l=a.next?a.next-1:a.episodes,c=(a.progress>l&&(l=a.progress),a.progress),l=(c="CURRENT"!==a.list&&"REPEATING"!==a.list?l:c)-i,c=o-60*t.data.SaveMediaListEntry.media.duration*l,i=(d-l<1?r.parent().addClass("hidden"):(r.attr("data-left-episode",d-l),r.html(d-l)),c<60?n.addClass("hidden"):n.html(humantimeFormat(c,!1)),a.progress/(a.episodes||a.progress)*100);$("[stacked-percentage-progress-indicator]",g).attr("style",`--percentage-complete: ${i}%`),a.progress>=e?($("[data-is-updating]",g).attr("data-is-updating","maxed"),$("[data-not-complete]",g).attr("data-not-complete","false"),$("[data-is-updating]",p).attr("data-is-updating","maxed"),$("[current-progress-indicator]",g).html(a.progress),$("[current-progress-indicator]",p).html(a.progress),(s.endsWith("InProgress")||"delayedAnime"===s&&a.episodes)&&(g.remove(),p.remove(),normalizeEmptyUI())):($("[current-progress-indicator]",g).html(a.progress),$("[data-not-complete]",g).attr("data-not-complete","true"),$("[current-progress-indicator]",p).html(a.progress),$("[next-progress-indicator]",g).html(String(a.progress+1)+"?"),$("[next-progress-indicator]",p).html(String(a.progress+1)+"?"),$("[data-is-updating]",g).attr("data-is-updating","false"),$("[data-is-updating]",p).attr("data-is-updating","false")),"CURRENT"!==a.list&&"REPEATING"!==a.list&&(g.remove(),p.remove(),$.attribute("schedule-block-stacked-id",String(u)).remove(),$.attribute("schedule-grid-block-id",String(u)).remove(),normalizeEmptyUI()),$.id("[P].save").attr("data-is-saving","false")}})}function normalizeEmptyUI(){$("[watchlist-section]").each((t,e)=>{var e=$(e),a=e.attr("watchlist-section"),i=$.attribute("watchlist-section-item",a);i.length<1&&(i.remove(),e.remove(),$.attribute("watchlist-section-sub-item",a).remove())}),$("[schedule-of-day]").each((t,e)=>{var e=$(e),a=e.attr("schedule-of-day");$.attribute("schedule-of-day-item",a).length<1&&(0<$("[schedule-of-day-is-empty]",e).length||e.html('<span class="text-xs w-full h-full flex items-center justify-center text-crumb-bright/30 text-pretty text-center px-3 italic" schedule-of-day-is-empty>None of the anime from your watchlist airs on this day.</span>'))}),$("[data-grid-schedule-category]").each((t,e)=>{var e=$(e),a=e.attr("data-grid-schedule-category"),i=$.attribute("grid-of-schedule-item",a);"sunday-padding"!==a&&i.length<1&&(0<$("[schedule-of-day-is-empty]",e).length||$.attribute("schedule-grid-of-day",a).html('<span class="text-xs w-full h-full flex items-center justify-center text-crumb-bright/40 text-pretty text-center italic col-span-3 py-3" schedule-of-day-is-empty>No anime airing.</span>'))})}function makeNotification(t){$.state.notification_interval&&clearTimeout($.state.notification_interval),$.id("[N]").attr("data-is-active","true"),$.id("[N].content").html(t),$.state.notification_interval=setTimeout(()=>{$.state.notification_interval=null,$.id("[N]").attr("data-is-active","false")},4e3)}function updateMediaEditWindowInput(t,e){var t=$.id("[P]."+t),a=t.attr("data-max-episodes"),e=(Number(t.val())||0)+e;e<0?t.val(0):void 0===a||"infinite"===a?t.val(e):(e>Number(a)&&(e=Number(a)),t.val(e),t.attr("data-last-valid-value",e))}function hideMediaEditWindow(){$.id("[P]").attr("data-is-active","false"),$.id("[P]@__remove_marquee").replaceWith($.id("[P]@__remove_marquee").html()),$.id("[P]-screen").fadeOut()}function ShowstatusSelectWindow(){$("[data-is-status-selected]").attr("data-is-status-selected","false"),$.attribute("data-status-id",$.id("[P].current_status").attr("data-current-status-id")).attr("data-is-status-selected","true"),$.id("[S]").attr("data-is-active","true"),$.id("[S]-screen").fadeIn()}function hideStatusSelectWindow(){$.id("[S]").attr("data-is-active","false"),$.id("[S]-screen").fadeOut()}function setStatusWindowValue(t){null!==t&&$.id("[P].current_status").attr("data-current-status-id",t),hideStatusSelectWindow()}function getWatchListIcon(t){return $.id("[M]-watchlist@icon."+t).html()}function calculateLeftover(t){var i=0,s=0;return $.each(t,(t,e)=>{var a=e.next?e.next-1:e.episodes,a=(a=a<e.progress?e.progress:a)-e.progress;i+=a,s+=(e.duration||0)*a}),{episode:i,duration:60*s}}function generateWatchListContent(t){var e=t.filter(t=>null!==t.next&&"RELEASING"===t.status&&"ANIME"===t.type),a=t.filter(t=>null===t.next&&"RELEASING"===t.status&&"MUSIC"!==t.format&&"MOVIE"!==t.format&&"ANIME"===t.type),i=t.filter(t=>null===t.next&&"FINISHED"===t.status&&"MUSIC"!==t.format&&"MOVIE"!==t.format&&"ANIME"===t.type),s=t.filter(t=>null===t.next&&("FINISHED"===t.status||"RELEASING"===t.status)&&"MOVIE"===t.format&&"ANIME"===t.type),r=t.filter(t=>null===t.next&&("FINISHED"===t.status||"RELEASING"===t.status)&&"MUSIC"===t.format&&"ANIME"===t.type),n=t.filter(t=>"NOT_YET_RELEASED"===t.status&&"ANIME"===t.type),d=t.filter(t=>"HIATUS"===t.status&&"ANIME"===t.type),o=t.filter(t=>"NOVEL"!==t.format&&"MANGA"===t.type&&"RELEASING"===t.status),l=t.filter(t=>"NOVEL"!==t.format&&"MANGA"===t.type&&"RELEASING"!==t.status),t=t.filter(t=>"NOVEL"===t.format&&"MANGA"===t.type),c=[];return e.length&&c.push({category:"airingAnime",content:e,name:"Airing Anime",type:"anime",left:calculateLeftover(e)}),a.length&&c.push({category:"delayedAnime",content:a,name:"Delayed Anime",type:"anime",left:calculateLeftover(a)}),i.length&&c.push({category:"animeInProgress",content:i,name:"Anime in Progress",type:"anime",left:calculateLeftover(i)}),s.length&&c.push({category:"movieInProgress",content:s,name:"Movie in Progress",type:"anime",left:calculateLeftover(s)}),r.length&&c.push({category:"musicInProgress",content:r,name:"Music in Progress",type:"anime",left:calculateLeftover(r)}),n.length&&c.push({category:"upcomingAnime",content:n,name:"Upcoming Anime",type:"anime",left:calculateLeftover(n)}),d.length&&c.push({category:"animeOnHiatus",content:d,name:"Anime on Hiatus",type:"anime",left:calculateLeftover(d)}),o.length&&c.push({category:"airingManga",content:o,name:"Releasing Manga",type:"manga",left:calculateLeftover(o)}),l.length&&c.push({category:"mangaInProgress",content:l,name:"Manga in Progress",type:"manga",left:calculateLeftover(l)}),t.length&&c.push({category:"novelInProgress",content:t,name:"Novel in Progress",type:"manga",left:calculateLeftover(t)}),c}function incrementMedia(t,n){var d=$.attribute("data-stacked-id",t),o=$.attribute("data-grid-id",t),l=($("[data-is-updating]",d).attr("data-is-updating","true"),$("[data-is-updating]",o).attr("data-is-updating","true"),Number(t)),t=$.state.sessionWatchList[l].progress+1;$.ajax({url:"https://graphql.anilist.co",method:"POST",timeout:4e4,headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:"Bearer "+$.state.session_token},data:JSON.stringify({query:$.state.increment_graphql,variables:{mediaid:l,progress:t}}),error:()=>{makeNotification("Failed to Update !"),$("[data-is-updating]",d).attr("data-is-updating","false"),$("[data-is-updating]",o).attr("data-is-updating","false")},success:t=>{var e,a=$.state.sessionWatchList[l],i=(a.progress=t.data.SaveMediaListEntry.progress,e=a.next?a.next-1:a.episodes||1/0,$.attribute("data-category-left-episode",n)),s=$.attribute("data-category-left-duration",n),r=Number(i.attr("data-left-episode")),t=Number(s.attr("data-left-duration"))-60*t.data.SaveMediaListEntry.media.duration,i=(r<=1?i.parent().addClass("hidden"):(i.attr("data-left-episode",r-1),i.html(r-1)),t<60?s.addClass("hidden"):s.html(humantimeFormat(t,!1)),a.progress/(a.episodes||a.progress)*100);$("[stacked-percentage-progress-indicator]",d).attr("style",`--percentage-complete: ${i}%`),a.progress>=e?($("[data-is-updating]",d).attr("data-is-updating","maxed"),$("[data-not-complete]",d).attr("data-not-complete","false"),$("[data-is-updating]",o).attr("data-is-updating","maxed"),$("[current-progress-indicator]",d).html(a.progress),$("[current-progress-indicator]",o).html(a.progress),(n.endsWith("InProgress")||"delayedAnime"===n&&a.episodes)&&(d.remove(),o.remove(),normalizeEmptyUI())):($("[data-not-complete]",d).attr("data-not-complete","true"),$("[current-progress-indicator]",d).html(a.progress),$("[current-progress-indicator]",o).html(a.progress),$("[next-progress-indicator]",d).html(String(a.progress+1)+"?"),$("[next-progress-indicator]",o).html(String(a.progress+1)+"?"),$("[data-is-updating]",d).attr("data-is-updating","false"),$("[data-is-updating]",o).attr("data-is-updating","false"))}})}function displayListsContent(t,e){$.id("[M]-lists.mediaContent.stacked").append(nunjucks.renderString($.id("[M]-lists.mediaContent@template.stacked").html(),{data:e,format:t})),$.id("[M]-lists.mediaContent.grids").append(nunjucks.renderString($.id("[M]-lists.mediaContent@template.grids").html(),{data:e,format:t})),$.attribute("data-lists-cetegory",t).attr("data-is-loading","false"),$("img[lazyload]").lazyload()}function resetListsView(){$.id("[M]-lists.mediaContent.stacked").empty(),$.id("[M]-lists.mediaContent.grids").empty(),$.each(["ANIME","MUSIC","MANGA","NOVEL","MOVIE","SPECIAL"],(t,e)=>{$.attribute("data-lists-cetegory",e).attr("data-is-loading","true")}),backToListsCategoryFromStatus(),$.state.selected_list_category=void 0,$.state.selected_list_status=void 0}function processListsContent(a){var s={ANIME:{CURRENT:[],PLANNING:[],COMPLETED:[],DROPPED:[],PAUSED:[],REPEATING:[]},MUSIC:{CURRENT:[],PLANNING:[],COMPLETED:[],DROPPED:[],PAUSED:[],REPEATING:[]},MANGA:{CURRENT:[],PLANNING:[],COMPLETED:[],DROPPED:[],PAUSED:[],REPEATING:[]},NOVEL:{CURRENT:[],PLANNING:[],COMPLETED:[],DROPPED:[],PAUSED:[],REPEATING:[]},MOVIE:{CURRENT:[],PLANNING:[],COMPLETED:[],DROPPED:[],PAUSED:[],REPEATING:[]},SPECIAL:{CURRENT:[],PLANNING:[],COMPLETED:[],DROPPED:[],PAUSED:[],REPEATING:[]}};return $.each(["chunk_1","chunk_2","chunk_3","chunk_4","chunk_5","chunk_6"],(t,e)=>{$.each(a[e].lists,(t,e)=>{var i;e.isCustomList||(i=e.status,$.each(e.entries,(t,e)=>{var e=e.media,a="MUSIC"===e.format||"NOVEL"===e.format||"MOVIE"===e.format?e.format:"SPECIAL"===e.format||"OVA"===e.format?"SPECIAL":e.type;s[a][i].push({title:e.title.userPreferred,site:e.siteUrl,id:e.id,cover:{large:e.coverImage.large,small:e.coverImage.medium}})}))})}),s}function fetchAndDisplayListsContent(e){var t=localStorage.getItem($.state.session_anime_list_cache_id),a=localStorage.getItem($.state.session_manga_list_cache_id);"ANIME"===e&&t&&USE_CACHE?(displayListsContent("ANIME",(t=JSON.parse(t)).ANIME),displayListsContent("MUSIC",t.MUSIC),displayListsContent("MOVIE",t.MOVIE),displayListsContent("SPECIAL",t.SPECIAL),fetchAndDisplayListsContent("MANGA")):"MANGA"===e&&a&&USE_CACHE?(displayListsContent("MANGA",(a=JSON.parse(a)).MANGA),displayListsContent("NOVEL",a.NOVEL)):$.ajax({url:"https://graphql.anilist.co",method:"POST",timeout:4e4,headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:"Bearer "+$.state.session_token},data:JSON.stringify({query:$.state.media_lists_graphql,variables:{userid:$.state.session_id,mediatype:e}}),error:()=>{setTimeout(()=>{fetchAndDisplayListsContent(e)},1e4)},success:t=>{t=processListsContent(t.data);"ANIME"===e?(displayListsContent("ANIME",t.ANIME),displayListsContent("MUSIC",t.MUSIC),displayListsContent("MOVIE",t.MOVIE),displayListsContent("SPECIAL",t.SPECIAL),fetchAndDisplayListsContent("MANGA"),USE_CACHE&&localStorage.setItem($.state.session_anime_list_cache_id,JSON.stringify(t))):(displayListsContent("MANGA",t.MANGA),displayListsContent("NOVEL",t.NOVEL),USE_CACHE&&localStorage.setItem($.state.session_manga_list_cache_id,JSON.stringify(t)))}})}function viewListsCategory(a){"true"===$.attribute("data-lists-cetegory",a).attr("data-is-loading")?makeNotification("Fetching Data !"):($.state.selected_list_category=a,$.each(["CURRENT","PLANNING","COMPLETED","DROPPED","PAUSED","REPEATING"],(t,e)=>{$.id("[M]-lists.count@"+e).html(String($.attribute("category-status-id",a+"."+e).length).replace(/0/g,"O"))}),$.id("[M]-lists").attr("data-current-lists-section","status"),$.id("[M]-lists.status_selection_text").html(a))}function backToListsCategoryFromStatus(){$.id("[M]-lists").attr("data-current-lists-section","categories")}function backToListsStatusFromMedia(){$.id("[M]-lists").attr("data-current-lists-section","status")}function viewListsMedia(t){var e=$.id("[M]-lists.mediaContent.stacked"),a=$.id("[M]-lists.mediaContent.grids");$.state.selected_list_status=t,e.attr("data-selected-list-to-view",$.state.selected_list_category+"-"+t),a.attr("data-selected-list-to-view",$.state.selected_list_category+"-"+t),setTimeout(()=>{$.id("[M]-lists").attr("data-current-lists-section","media")},100)}function viewListsGridMoreInfo(t){var e=$.attribute("list-grid-section-id",t);$.state.last_list_grid_more_info===t?(e.attr("data-more-info-visible","false"),$.state.last_list_grid_more_info=void 0):(e.attr("data-more-info-visible","true"),$.state.last_list_grid_more_info&&$.attribute("list-grid-section-id",$.state.last_list_grid_more_info).attr("data-more-info-visible","false"),$.state.last_list_grid_more_info=t)}nunjucks.configure({autoescape:!0}),detectSwipeDircetion($.id("[M]")[0],function(t){var e=$.state.current_main_content,a=$.state.current_main_content_type,i=$.state.current_schedule_day_active,s=$.state.current_schedule_format,r=$.id("[M]-lists").attr("data-current-lists-section");"watchlist"===e?"right"===t&&"manga"===a?toggleWatchListType("anime"):"left"===t&&("anime"===a?toggleWatchListType("manga"):"manga"===a&&changeMainContent("schedule")):"schedule"===e?"grids"===s&&"right"===t?changeMainContent("watchlist"):"grids"===s&&"left"===t?changeMainContent("lists"):"right"===t&&"stacked"===s?"monday"===i?changeMainContent("watchlist"):"tuesday"===i?changeScheduleDay("monday"):"wednesday"===i?changeScheduleDay("tuesday"):"thursday"===i?changeScheduleDay("wednesday"):"friday"===i?changeScheduleDay("thursday"):"saturday"===i?changeScheduleDay("friday"):"sunday"===i&&changeScheduleDay("saturday"):"left"===t&&"stacked"===s&&("monday"===i?changeScheduleDay("tuesday"):"tuesday"===i?changeScheduleDay("wednesday"):"wednesday"===i?changeScheduleDay("thursday"):"thursday"===i?changeScheduleDay("friday"):"friday"===i?changeScheduleDay("saturday"):"saturday"===i?changeScheduleDay("sunday"):"sunday"===i&&changeMainContent("lists")):"lists"===e&&("right"===t?"categories"===r?changeMainContent("schedule"):"status"===r?backToListsCategoryFromStatus():"media"===r&&backToListsStatusFromMedia():"left"===t&&("categories"===r?$.state.selected_list_category&&viewListsCategory($.state.selected_list_category):"status"===r&&$.state.selected_list_category&&$.state.selected_list_status&&viewListsMedia($.state.selected_list_status)))}),detectSwipeDircetion($.id("[P]")[0],function(t){"down"===t&&hideMediaEditWindow()}),$.id("[L]-api_key_login_input").on("keypress",function(t){13==t.which&&apiKeyLogin()}),$(document).ready(()=>{$.id("[M]-schedule.grids.content").scroll(()=>{var a={};$("[data-grid-schedule-category]").each((t,e)=>{a[e.getAttribute("data-grid-schedule-category")]=getElementVisibilityPercentage(e)});var t=Object.entries(a).sort((t,e)=>e[1]-t[1])[0][0];1!==a["sunday-padding"]&&"sunday-padding"!==t||(t="sunday"),$("[data-scrolled-schedule-day]").attr("data-scrolled-schedule-day",t)})}),$(document).ready(()=>{new ClipboardJS("[clipboard-item]").on("success",function(t){makeNotification("copied"),t.clearSelection()})}),$(document).ready(()=>{$.id("[P].score_input").bind("change keyup",function(){var t=$.id("[P].score_input"),e=$.id("[P].score_slider"),a=Number(t.val())||null;null===(a=0===Number(t.val())?0:a)&&""!==t.val()?(a=Number(t.attr("data-last-valid-value")),t.val(a)):""===t.val()?(t.attr("data-last-valid-value",0),a=0):(100<a&&t.val(a=100),t.attr("data-last-valid-value",a)),e.val(a)})}),$(document).ready(()=>{$.each([$.id("[P].repeats"),$.id("[P].progress")],(t,a)=>{a.bind("change keyup",function(){var t=$(this),e=Number(t.val())||null;null===e&&""!==t.val()&&t.val(a.attr("data-last-valid-value")||0),""===t.val()?a.attr("data-last-valid-value",0):a.attr("data-last-valid-value",e)})})});